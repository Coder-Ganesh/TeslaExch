if(typeof(CreateAccountHandler)=="undefined"){CreateAccountHandler={}}(function(){CreateAccountHandler.init=function(){PTAllowedHandler.init(PageConfig.agentPT);ChangeCommissionHandler.init("commission",PageConfig.agentComm);d()};CreateAccountHandler.showDialog=function(){var g=$j("#site").val();$j.ajax({type:"POST",url:"/agent/memberManagementController/querySelfInfo",data:{action:"limit",site:g},success:function(j){if(j.error){NoticeHandler.error(j.error)}else{PageConfig.isEnableExposureLimit=j.isEnableExposureLimit;PageConfig.ptMultiple=j.ptMultiple;PageConfig.agentComm=j.comm;JsCache.get("#commission").val(PageConfig.agentComm);var i=$j("#commission");if(WebSiteType.SKYINPLAY.value==j.site){i.attr("disabled",true);i.addClass("disable")}else{i.attr("disabled",false);i.removeClass("disable")}var h=$j("#exposure");if(PageConfig.isEnableEditExposureLimit){h.val("");h.attr("disabled",false);h.removeClass("disable")}else{h.val(-1);h.attr("disabled",true);h.addClass("disable")}}}});var f=$j("#currency").val();$j.ajax({type:"POST",url:"/agent/memberManagementController/querySelfInfo",data:{action:"pt",currency:f},success:function(h){if(h.error){NoticeHandler.error(h.error)}else{PageConfig.agentPT=h.maxBackPT;JsCache.get("#yourPT").text(PageConfig.agentPT)}}});JsCache.get("#createModal").delegate("#createBtn","click",function(){CreateAccountHandler.check()});$j(document).bind("keydown",function(h){if(KeyEventUtils.isEnterKey(h.keyCode)){$j("#createBtn").click()}if(KeyEventUtils.isEscKey(h.keyCode)){CreateAccountHandler.hideDialog()}});JsCache.get("#createModal").show()};CreateAccountHandler.hideDialog=function(){JsCache.get("#createModal").hide();$j(document).unbind("keydown");JsCache.get("#createModal").undelegate("#createBtn","click");JsCache.get("#email").val("");JsCache.get("#email").removeClass("error");JsCache.get("#userName").val("");JsCache.get("#userName").removeClass("error");JsCache.get("#userNameErrorText").html("").hide();JsCache.get("#allowMaxPT").removeClass("error").val("");JsCache.get("#firstName").val("");JsCache.get("#lastName").val("");JsCache.get("#phone").val("");PTAllowedHandler.resetValue();e();if($j("#exposure").length){JsCache.get("#exposure").val("");JsCache.get("#exposure").removeClass("error")}if($j("#currency").length){JsCache.get("#currency").val("")}if($j("#commission").length){JsCache.get("#commission").val(0)}};CreateAccountHandler.check=function(){try{var k={};var u=$j("#email").val().trim();if(!ValidateDataUtil.isEmail(u)){JsCache.get("#email").addClass("error");JsCache.get("#email").focus();throw new NotValidException(I18N.get("msg.error.validation.errorFormat",["Email"]))}JsCache.get("#email").removeClass("error");k.email=u;var q=$j("#userName").val().trim();if(!ValidateDataUtil.isAlphaNumeric(q,false)){JsCache.get("#userName").addClass("error");JsCache.get("#userName").focus();throw new NotValidException(I18N.get("msg.error.validation.userNameIsNotValid"))}JsCache.get("#userName").removeClass("error");var g=$j("#userPassword").val().trim();if(!ValidateDataUtil.isValidPassword(g)){JsCache.get("#userPassword").addClass("error");JsCache.get("#userPassword").focus();throw new NotValidException(I18N.get("msg.error.validation.passwordFormatError",["Password"]))}JsCache.get("#userPassword").removeClass("error");var y=$j("#repeatPassword").val().trim();if(!ValidateDataUtil.isValidPassword(y)){JsCache.get("#repeatPassword").addClass("error");JsCache.get("#repeatPassword").focus();throw new NotValidException(I18N.get("msg.error.validation.passwordFormatError",["Repeat password"]))}JsCache.get("#repeatPassword").removeClass("error");if(q&&g==q){e();JsCache.get("#userPassword").addClass("error");JsCache.get("#userPassword").focus();throw new NotValidException(I18N.get("msg.error.validation.passwordFormat"))}else{JsCache.get("#userName").removeClass("error");k.userName=q;JsCache.get("#userPassword").removeClass("error");k.password=EncryptUtil.mask(g);JsCache.get("#repeatPassword").removeClass("error");k.repeatPassword=EncryptUtil.mask(y)}var f=$j("#firstName").val().trim();if(!ValidateDataUtil.isEmpty(f)){k.firstName=ValidateDataUtil.trim(f)}var t=$j("#lastName").val().trim();if(!ValidateDataUtil.isEmpty(t)){k.lastName=ValidateDataUtil.trim(t)}var n=$j("#phone").val().trim();if(!ValidateDataUtil.isEmpty(n)){k.phone=ValidateDataUtil.trim(n)}if($j("#exposure").length){var z=JsCache.get("#exposure").val().trim();if(ValidateDataUtil.isEmpty(z)||isNaN(z)){JsCache.get("#exposure").addClass("error");JsCache.get("#exposure").focus();throw new NotValidException(I18N.get("msg.error.validation.mustBeNumber",["Exposure"]))}if(-1==z){if(PageConfig.isEnableExposureLimit){throw new NotValidException(I18N.get("msg.error.validation.mustBeInteger",["Exposure"]))}}else{if(!MathUtil.isInteger(z)){JsCache.get("#exposure").addClass("error");JsCache.get("#exposure").focus();throw new NotValidException(I18N.get("msg.error.validation.mustBeInteger",["Exposure"]))}if(!MathUtil.isPositive(z)){JsCache.get("#exposure").addClass("error");JsCache.get("#exposure").focus();throw new NotValidException(I18N.get("msg.error.validation.positive",["Exposure"]))}}JsCache.get("#exposure").removeClass("error");k.exposure=z}var w=$j("#site");if(w&&w.length){var h=w[0];if(h.options.length==0||h.selectedIndex==-1||ValidateDataUtil.isEmpty(h.options[h.selectedIndex].value)){JsCache.get("#site").focus();throw new NotValidException(I18N.get("msg.error.validation.fieldEmpty","Site"))}else{k.site=w.val()}}if($j("#currency").length){var h=$j("#currency")[0];if(h.options.length==0||h.selectedIndex==-1||ValidateDataUtil.isEmpty(h.options[h.selectedIndex].value)){JsCache.get("#currency").focus();throw new NotValidException(I18N.get("msg.error.validation.fieldEmpty","Currency"))}else{var l=$j("#currency").val();k.currency=l}}if($j("#paymentMode").length){var h=$j("#paymentMode")[0];if(h.options.length==0||h.selectedIndex==-1||ValidateDataUtil.isEmpty(h.options[h.selectedIndex].value)){JsCache.get("#paymentMode").focus();throw new NotValidException(I18N.get("msg.error.validation.fieldEmpty","Payment Mode"))}else{var i=$j("#paymentMode").val();k.paymentMode=i}}var m=ChangeCommissionHandler.getData();if(typeof(m)=="undefined"){return false}k.commission=m;var h=JsCache.get("#timezone")[0];if(h.options.length==0||h.selectedIndex==-1||ValidateDataUtil.isEmpty(h.options[h.selectedIndex].value)){JsCache.get("#timezone").focus();throw new NotValidException(I18N.get("msg.error.validation.fieldEmpty","timezone"))}else{var v=JsCache.get("#timezone").val();k.timezone=v}if(PageConfig.isShowMaxLossLimit||PageConfig.isShowMaxWinLimit){var j="Max Loss Limit";if(PageConfig.queryAccountLevel==UserType.MASTER_AGENT.value){j="Max Win Limit"}var r=$j("#maxWinLossLimit");var p=r.val().trim();if(ValidateDataUtil.isEmpty(p)||isNaN(p)){r.addClass("error");r.focus();throw new NotValidException(I18N.get("msg.error.validation.mustBeNumber",[j]))}r.removeClass("error");k.maxWinLossLimit=p}var o=PTAllowedHandler.getSportPTData();if(typeof(o)=="undefined"){return false}k.sportPTs=o;var s=PTAllowedHandler.getCompanyFancyBetPtPercentage();if(null==s){return false}k.companyFancyBetPtPercentage=s;$j.ajax({type:"POST",url:"/agent/memberManagementController/createAccount",data:k,beforeSend:function(){JsCache.get("#loading").show()},complete:function(){JsCache.get("#loading").hide()},success:function(D){if(D.error!=null){var B;if(D.error[0]=="["){B="";var A=JSON.parse(D.error);for(var C in A){B+=A[C]+"\n"}}else{B=D.error}NoticeHandler.error(B)}else{NoticeHandler.success("Add Member Success!!");window.location.replace(HomePageType.AGENT.url)}},error:function(C,A,B){Trace.log(C.status);Trace.log(B);return}})}catch(x){NoticeHandler.error(x.message)}return false};CreateAccountHandler.checkAccountExisted=function a(){$j.ajax({type:"POST",url:"/agent/memberManagementController/queryAccount",data:{action:"isAccountValid",userName:$j("#userName").val()},beforeSend:function(){JsCache.get("#loading").show()},complete:function(){JsCache.get("#loading").hide()},success:function(f){if(f.error){Trace.log(f.error)}else{if(f.isValid){JsCache.get("#userName").removeClass("error");JsCache.get("#userNameErrorText").html("").hide()}else{JsCache.get("#userName").addClass("error");JsCache.get("#userNameErrorText").html(I18N.get("msg.error.validation.isAccountExisted")).show()}}}})};function d(){JsCache.get("#userName").blur(function(){CreateAccountHandler.checkAccountExisted()});JsCache.get("#userPassword").blur(function(){c()});JsCache.get("#repeatPassword").blur(function(){b()});if(PageConfig.agentLevel==UserType.COMPANY.value){JsCache.get("#currency").change(function(){var f=$j(this).val();$j.ajax({type:"POST",url:"/agent/memberManagementController/querySelfInfo",data:{action:"pt",currency:f},success:function(g){if(g.error){NoticeHandler.error(g.error)}else{PageConfig.agentPT=g.maxBackPT;JsCache.get("#yourPT").text(PageConfig.agentPT)}}})});JsCache.get("#site").change(function(){var f=$j(this).val();$j.ajax({type:"POST",url:"/agent/memberManagementController/querySelfInfo",data:{action:"limit",site:f},success:function(i){if(i.error){NoticeHandler.error(i.error)}else{PageConfig.isEnableExposureLimit=i.isEnableExposureLimit;PageConfig.ptMultiple=i.ptMultiple;PageConfig.agentComm=i.comm;JsCache.get("#commission").val(PageConfig.agentComm);var h=$j("#commission");if(WebSiteType.SKYINPLAY.value==i.site){h.attr("disabled",true);h.addClass("disable")}else{h.attr("disabled",false);h.removeClass("disable")}var g=$j("#exposure");if(PageConfig.isEnableEditExposureLimit){g.val("");g.attr("disabled",false);g.removeClass("disable")}else{g.val(-1);g.attr("disabled",true);g.addClass("disable")}}}})})}}function c(){var f=JsCache.get("#userPassword").val();if(f){if(ValidateDataUtil.isValidPassword(f)&&f!=JsCache.get("#userName").val()){JsCache.get("#userPassword").removeClass("error");JsCache.get("#passwordErrorText").html("").hide()}else{JsCache.get("#userPassword").addClass("error");JsCache.get("#passwordErrorText").html("Check password invalid").show();NoticeHandler.error(I18N.get("msg.error.validation.passwordFormatError"))}}}function b(){var f=JsCache.get("#userPassword").val();var g=JsCache.get("#repeatPassword").val();if(f){if(f==g){JsCache.get("#repeatPassword").removeClass("error");JsCache.get("#repeatPasswordErrorText").html("").hide()}else{JsCache.get("#repeatPassword").addClass("error");JsCache.get("#repeatPasswordErrorText").html(I18N.get("msg.error.validation.passwordNotMatch")).show()}}}function e(){JsCache.get("#userPassword").val("");JsCache.get("#userPassword").removeClass("error");JsCache.get("#passwordErrorText").html("").hide();JsCache.get("#repeatPassword").val("");JsCache.get("#repeatPassword").removeClass("error");JsCache.get("#repeatPasswordErrorText").html("").hide()}})();