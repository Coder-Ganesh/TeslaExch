if(typeof(IndexHandler)=="undefined"){IndexHandler={}}(function(){IndexHandler.data="";IndexHandler.boxOffset=[];IndexHandler.init=function(){CreateAccountHandler.init();BankingHandler.init();ChangeStatusHandler.init();CreditReferenceHandler.init();IndexHandler.listMember();$j("#refresh").click(function(){IndexHandler.listMember()});BankingHandler.updateInfo=function(f,i){CurrencyUtil.updateSetting({currencySymbol:""});var h=IndexHandler.data[f];h.balance=i.balance;h.creditPL=i.creditPL;h.creditLimit=i.creditLimit;h.creditOut=i.creditOut;h.exposure=i.exposure;h.profitLoss=i.profitLoss;h.available=i.availableBalance;$j("#balance"+f).html(CurrencyUtil.formatter(h.balance));$j("#creditPL"+f).html(CurrencyUtil.formatter(h.creditPL));$j("#creditLimit"+f).html(CurrencyUtil.formatter(h.creditLimit));$j("#creditOut"+f).html(CurrencyUtil.formatter(h.creditOut));$j("#currentExposure"+f).html(""+CurrencyUtil.formatter(h.exposure));$j("#profitLoss"+f).html(""+CurrencyUtil.formatter(h.profitLoss));$j("#available"+f).html(CurrencyUtil.formatter(h.available));CurrencyUtil.updateSetting({currencySymbol:PageConfig.currencySymbol});var j=IndexHandler.data[IndexHandler.data.length-1];var k=MathUtil.decimal.subtract(i.balance,h.balance);var m=MathUtil.decimal.subtract(i.exposure,h.exposure);var l=MathUtil.decimal.subtract(i.availableBalance,h.available);j.totalBalance=MathUtil.decimal.add(j.totalBalance,k);j.totalExposure=MathUtil.decimal.add(j.totalExposure,m);j.totalAvailBal=MathUtil.decimal.add(j.totalAvailBal,l);$j("#totalBalance").html(PageConfig.CurrencyTypeName+" "+CurrencyUtil.formatter(j.totalBalance));$j("#totalExposure").html(PageConfig.CurrencyTypeName+" "+CurrencyUtil.formatter(j.totalExposure));$j("#totalAvailBal").html(PageConfig.CurrencyTypeName+" "+CurrencyUtil.formatter(j.totalAvailBal));var e=i.mainBalance;$j("#mastersBalance").html(PageConfig.CurrencyTypeName+" "+CurrencyUtil.formatter(e));var g=MathUtil.decimal.add(j.totalAvailBal,e);$j("#mastersAvailBal").html(PageConfig.CurrencyTypeName+" "+CurrencyUtil.formatter(g));j.myCreditLimit=i.myCreditLimit;j.totalCreditGivenOut=i.totalCreditGivenOut;j.myCreditAvailBal=i.myCreditAvailBal;JsCache.get("#myCreditLimit").html(PageConfig.downlineCurrencyTypeName+" "+CurrencyUtil.formatter(j.myCreditLimit));JsCache.get("#totalCreditGivenOut").html(PageConfig.downlineCurrencyTypeName+" "+CurrencyUtil.formatter(j.totalCreditGivenOut));JsCache.get("#myCreditAvailBal").html(PageConfig.downlineCurrencyTypeName+" "+CurrencyUtil.formatter(j.myCreditAvailBal))}};IndexHandler.listMember=function(){try{$j.ajax({type:"POST",url:"/agent/memberManagementController/queryMember",data:{queryAccountID:PageConfig.queryAccountID,queryAccountLevel:PageConfig.queryAccountLevel},beforeSend:function(){JsCache.get("#loading").show()},complete:function(){JsCache.get("#loading").hide();IndexHandler.populate()},success:function(h){if(h==null){IndexHandler.data="";return}if(h.error){NoticeHandler.error(h.error);var e=JsCache.get("#agentPath").find(".last_li");e.removeClass("last_li").hide();e.prev().addClass("last_li")}else{IndexHandler.data=h;IndexHandler.queryExposure();if(PageConfig.queryAccountLevel<UserType.COMPANY.value){IndexHandler.queryTransferInfo()}}}})}catch(g){var f=JsCache.get("#agentPath").find(".last_li");f.removeClass("last_li").hide();f.prev().addClass("last_li");NoticeHandler.error(g.message)}};function c(h,g){$j("#totalBox").find("dl").hide();$j("#totalExposureDL").show();var e=JsCache.get("#tableTemplate");e.find("th").hide();e.find("td").hide();e.find("#accountTh").show();e.find("#accountCol").show();e.find("#availableBalanceTh").show();e.find("#available").show();e.find("#exposureTh").show();e.find("#currentExposure").show();e.find("#statusTh").show();e.find("#statusCol").show();e.find("#actionTh").show();e.find("#actionCol").show();if(h==PaymentModeType.CREDIT.value){$j("#creditLimitDL").show();$j("#creditGivenOutDL").show();$j("#creditAvailBalDL").show();$j("#myCurrentPLDL").show();$j("#transferablePLWithUplineDL").show();e.find("#creditLimitTh").show();e.find("#creditLimit").show();e.find("#currentPLTh").show();e.find("#currentPL").show();e.find("#transferablePLTh").show();e.find("#transferablePL").show()}else{if(h==PaymentModeType.CASH.value){$j("#totalBalanceDL").show();$j("#availableBalanceDL").show();$j("#masterBalanceDL").show();$j("#masterAvailableBalanceDL").show();if(PageConfig.queryAccountLevel==UserType.SHAREHOLDER.value){$j("#transferablePLWithUplineDL").show()}e.find("#balanceTh").show();e.find("#balance").show();e.find("#creditRefTh").show();e.find("#creditRef").show();e.find("#refPLTh").show();e.find("#refPL").show()}else{if(h==PaymentModeType.MIX.value){$j("#creditLimitDL").show();$j("#creditGivenOutDL").show();$j("#creditAvailBalDL").show();$j("#myCurrentPLDL").show();$j("#transferablePLWithUplineDL").show();e.find("#creditPLTh").show();e.find("#creditPL").show()}}}if(g){var f=JsCache.get("#tableOneBox");if(h==PaymentModeType.CREDIT.value){f.find("#creditLimitTh").show();f.find("#creditOutTh").show();f.find("#creditLimit").show();f.find("#currencyTotalCreditLimit").show();f.find("#currencyTotalCreditOut").show()}else{if(h==PaymentModeType.CASH.value){f.find("#balanceTh").show();f.find("#balance").show();f.find("#currencyTotalBal").show()}else{if(h==PaymentModeType.MIX.value){f.find("#creditPLTh").show();f.find("#creditPL").show();f.find("#currencyTotalCreditPL").show()}}}}}function b(m,k,v,z){var o;var q;var A;var s;for(var u=m;u<k;u++){var f=z.find("#dataTemplate").clone().show();f.attr("id","data_"+u);var w=IndexHandler.data[u];f.attr("id",u);CurrencyUtil.updateSetting({currencySymbol:""});f.find("#balance").attr("id","balance"+u).html(CurrencyUtil.formatter(w.balance));f.find("#creditPL").attr("id","creditPL"+u).html(CurrencyUtil.formatter(w.creditPL));f.find("#creditLimit").attr("id","creditLimit"+u).html(CurrencyUtil.formatter(w.creditLimit));f.find("#currentExposure").attr("id","currentExposure"+u);f.find("#currentPL").attr("id","currentPL"+u);f.find("#transferablePL").attr("id","transferablePL"+u);f.find("#available").attr("id","available"+u);var h=f.find("#creditRef");h.prop("id","creditRef"+u);var x=w.creditRef;var p=MathUtil.decimal.subtract(w.balance,x);var e=f.find("#refPL");e.prop("id","refPL"+u);e.html(CurrencyUtil.formatter(p));var y=f.find("#status").attr("id","status"+u);StatusUtilHandler.genStatusHtml(y,w);f.find("#profile").attr("id","profile"+u).attr("href","/agent/memberList/accountSummary.jsp?uid="+w.userID);var g=f.find("#banking");var n=f.find("#change");var j=$j(".add_member");var r=(v==PageConfig.agentLevel-1||PageConfig.agentLevel==UserType.MASTER_AGENT.value);if(PageConfig.ENABLE_SUBACCOUNT_DOWNLINE_VIEW){r=!PageConfig.isSubAccount&&r}if(r){if(w.isSystemLocked==0&&w.isSystemSuspended==0){if(w.paymentMode!=PaymentModeType.CASH.value){g.attr("id","banking"+u).attr("onclick","BankingHandler.showDialog("+u+",'"+w.userID+"',"+w.site+")");g.show()}else{g.hide();var l=f.find("#creditRefBtn");l.data("amount",x);l.html(CurrencyUtil.formatter(x));l.attr("onclick","CreditReferenceHandler.showDialog("+u+",'"+w.userID+"',"+w.site+")")}n.attr("id","change"+u).attr("onclick","ChangeStatusHandler.showDialog("+u+",'"+w.userID+"',"+w.site+")")}else{g.hide();if(w.isSystemSuspended==1&&w.userLevel==0){n.attr("id","change"+u).attr("onclick","ChangeStatusHandler.showDialog("+u+",'"+w.userID+"',"+w.site+")")}else{n.hide()}}j.show()}else{g.hide();n.hide();j.hide();h.html(x)}if(PageConfig.agentLevel==UserType.COMPANY.value&&v==UserType.SHAREHOLDER.value){f.find("#site").attr("id","site"+u).html(w.siteLogo)}var t=f.find("#account");if(v==0){t=t.parent();t.html("");f.find("#p_l").attr("id","p_l"+u).attr("href","/agent/memberList/profitAndLoss.jsp?uid="+w.userID);f.find("#betting_history").attr("id","betting_history"+u).attr("href","/agent/memberList/bettingHistory.jsp?uid="+w.userID);z.find("#exposureLimitTh").show();f.find("#exposureLimit").attr("id","exposureLimit"+u).html(CurrencyUtil.formatter(w.exposureLimit)).show();f.find("#playerBalance"+u).hide()}else{t.attr("id","account"+u).attr("href","javascript: void(0);");f.find("#p_l").remove();f.find("#betting_history").remove();z.find("#playerBalanceTh").show();f.find("#playerBalance").attr("id","playerBalance"+u).html(CurrencyUtil.formatter(w.playerBalance)).show();if(w.paymentMode==PaymentModeType.CREDIT.value){f.find("#creditOut").attr("id","creditOut"+u).html(CurrencyUtil.formatter(w.creditOut))}o=MathUtil.decimal.add(o,w.balance);q=MathUtil.decimal.add(q,w.creditPL);A=MathUtil.decimal.add(A,w.creditLimit);s=MathUtil.decimal.add(s,w.creditOut)}StatusUtilHandler.genAccountHtml(t,w);z.append(f).show()}if(v!=0){a(z)}return[o,q,A,s]}function d(q,o,g,f){var i=typeof(IndexHandler.data[0].paymentMode)=="undefined"?PageConfig.paymentMode:IndexHandler.data[0].paymentMode;c(i,true);var h=JsCache.get("#tableOneBox").clone().show();h.attr("id",q+"_box");h.find("#currencyName").text(q);var n=h.find("#tableTemplate").clone().show();n.attr("id",q+"_table");h.find("#tableTemplate").after(n);var j=b(o,g,f,n);var l=n.find("#currencyTotal");l.attr("id",q+"_total");l.find("#currencyTotalBal").attr("id",q+"_totalBal").html(CurrencyUtil.formatter(j[0]));l.find("#currencyTotalCreditPL").attr("id",q+"_totalCreditPL").html(CurrencyUtil.formatter(j[1]));l.appendTo(n).show();JsCache.get("#mainWrap").append(h);var e=$j("#"+q+"_box");var p=e.offset().top;var m=e.find(".total").eq(1).offset().top;IndexHandler.boxOffset[IndexHandler.boxOffset.length]=[p,m]}function a(e){e.find(".ico_account").each(function(){$j(this).click(function(){var f=$j(this).parents("tr").attr("id");var g=IndexHandler.data[f];PageConfig.queryAccountID=g.userID;PageConfig.queryAccountLevel=PageConfig.queryAccountLevel-1;PageConfig.queryPaymentMode=g.paymentMode;PathHandler.goAhead(g.userID);IndexHandler.listMember()})})}IndexHandler.populate=function(){if(IndexHandler.data){var h=IndexHandler.data[IndexHandler.data.length-1];PageConfig.downlineCurrencyTypeName=h.currencyTypeName;PageConfig.downlineCurrencySymbol=h.currencySymbol;$j("#tableOneBox").nextAll().remove();if($j("#resultTable").length){$j("#resultTable").remove()}if(h.directUserType==5){JsCache.get("#totalBox").hide();var f=IndexHandler.data[0].currencyType;var g=0;for(var e=0;e<IndexHandler.data.length-1;e++){if(f!=IndexHandler.data[e].currencyType){d(f,g,e,h.directUserType);f=IndexHandler.data[e].currencyType;g=e}if(e+1==IndexHandler.data.length-1){d(f,g,e+1,h.directUserType)}}$j(window).scroll(function(){for(var l=0;l<IndexHandler.boxOffset.length;l++){var p=$j(document).scrollTop();var o=$j(".table_one_box").eq(l+1);var n=o.find("#"+l+"fixHead");if(n.length==0){var k=o.find(".table_one");n=k.clone().attr("id",l+"fixHead");n.css({position:"fixed",top:"0px",width:k.width(),"z-index":"1"}).insertBefore(k)}if(p>=IndexHandler.boxOffset[l][0]&&p+n.height()<=IndexHandler.boxOffset[l][1]){n.show()}else{n.hide()}}})}else{JsCache.get("#widthAll").show();if(PageConfig.isSubAccount){JsCache.get("#totalBox").hide()}else{JsCache.get("#totalBox").show()}CurrencyUtil.updateSetting({currencySymbol:PageConfig.downlineCurrencySymbol});JsCache.get("#totalBalance").html(PageConfig.downlineCurrencyTypeName+" "+CurrencyUtil.formatter(h.totalBalance));JsCache.get("#mastersBalance").html(PageConfig.downlineCurrencyTypeName+" "+CurrencyUtil.formatter(h.mastersBalance));JsCache.get("#myCreditLimit").html(PageConfig.downlineCurrencyTypeName+" "+CurrencyUtil.formatter(h.myCreditLimit));JsCache.get("#totalCreditGivenOut").html(PageConfig.downlineCurrencyTypeName+" "+CurrencyUtil.formatter(h.totalCreditGivenOut));JsCache.get("#myCreditAvailBal").html(PageConfig.downlineCurrencyTypeName+" "+CurrencyUtil.formatter(h.myCreditAvailBal));CurrencyUtil.updateSetting({currencySymbol:""});var i=typeof(IndexHandler.data[0].paymentMode)=="undefined"?PageConfig.queryPaymentMode:IndexHandler.data[0].paymentMode;c(i,false);var j=JsCache.get("#tableTemplate").clone().show();j.attr("id","resultTable");JsCache.get("#tableTemplate").after(j);b(0,IndexHandler.data.length-1,h.directUserType,j)}if(PageConfig.agentLevel==UserType.COMPANY.value){JsCache.get("#pathCurrency").find("strong").text(PageConfig.downlineCurrencyTypeName)}}else{NoticeHandler.info("No Data")}};IndexHandler.queryExposure=function(){$j.ajax({type:"POST",url:"/agent/memberManagementController/queryAccount",data:{queryAccountID:PageConfig.queryAccountID,queryAccountLevel:PageConfig.queryAccountLevel,action:"queryExposure"},beforeSend:function(){JsCache.get("#loading").show()},complete:function(){JsCache.get("#loading").hide()},success:function(m){if(m.error){Trace.log(m.error)}else{var o=0;var k=0;var e=0;var h=0;if(IndexHandler.data.length>1){var n=IndexHandler.data[IndexHandler.data.length-2].currencyType;var l=IndexHandler.data[IndexHandler.data.length-1].directUserType==UserType.PLAYER.value;CurrencyUtil.updateSetting({currencySymbol:""});for(var j=IndexHandler.data.length-2;j>=0;j--){var r=IndexHandler.data[j];var f=m[r.userID];IndexHandler.data[j].exposure=f;var q=r.playerBalance;var g=0;if(r.paymentMode==PaymentModeType.CREDIT.value){if(l){g=MathUtil.decimal.add(r.balance,f)}else{q=MathUtil.decimal.add(q,f);g=MathUtil.decimal.subtract(r.creditLimit,r.creditOut)}}else{if(r.paymentMode==PaymentModeType.CASH.value){g=MathUtil.decimal.add(r.balance,f)}else{if(r.paymentMode==PaymentModeType.MIX.value){g=MathUtil.decimal.add(r.creditPL,f)}}}g=g<0?0:g;IndexHandler.data[j].available=g;IndexHandler.data[j].playerBalance=q;$j("#playerBalance"+j).html(CurrencyUtil.formatter(q));$j("#currentExposure"+j).html(CurrencyUtil.formatter(f));$j("#available"+j).html(CurrencyUtil.formatter(g));o=MathUtil.decimal.add(o,f);k=MathUtil.decimal.add(k,g);if(j-1<0||n!=IndexHandler.data[j-1].currencyType){var p=$j("#"+n+"_total");p.find("#currencyTotalExposure").attr("id",n+"_totalExposure").html(CurrencyUtil.formatter(o));p.find("#currencyTotalAvailBal").attr("id",n+"_totalAvailBal").html(CurrencyUtil.formatter(k));if(j-1>=0){o=0;k=0;n=IndexHandler.data[j-1].currencyType}}}e=IndexHandler.data[IndexHandler.data.length-1].mastersBalance;h=MathUtil.decimal.add(k,e)}IndexHandler.data[IndexHandler.data.length-1].totalExposure=o;IndexHandler.data[IndexHandler.data.length-1].totalAvailBal=k;CurrencyUtil.updateSetting({currencySymbol:PageConfig.downlineCurrencySymbol});$j("#totalExposure").html(PageConfig.downlineCurrencyTypeName+" "+CurrencyUtil.formatter(o));$j("#totalAvailBal").html(PageConfig.downlineCurrencyTypeName+" "+CurrencyUtil.formatter(k));JsCache.get("#mastersAvailBal").html(PageConfig.downlineCurrencyTypeName+" "+CurrencyUtil.formatter(h))}}})};IndexHandler.queryTransferInfo=function(){$j.ajax({type:"POST",url:"/agent/memberManagementController/queryTransferInfo",data:{queryAccountID:PageConfig.queryAccountID},beforeSend:function(){JsCache.get("#loading").show()},complete:function(){JsCache.get("#loading").hide()},success:function(j){if(j.error){Trace.log(j.error);return}if(IndexHandler.data.length==0){return}CurrencyUtil.updateSetting({currencySymbol:PageConfig.downlineCurrencySymbol});$j("#myCurrentPL").html(PageConfig.downlineCurrencyTypeName+" "+CurrencyUtil.formatter(j.currentProfitLoss));$j("#transferablePLWithUpline").html(PageConfig.downlineCurrencyTypeName+" "+CurrencyUtil.formatter(j.availableTransferAmount));var f=j.members;if($j.isEmptyObject(f)){return}CurrencyUtil.updateSetting({currencySymbol:""});for(var h=IndexHandler.data.length-2;h>=0;h--){var e=IndexHandler.data[h];var k=f[e.userID].currentProfitLoss;var g=f[e.userID].availableTransferAmount;IndexHandler.data[h].currentProfitLoss=k;IndexHandler.data[h].availableTransferAmount=g;$j("#currentPL"+h).html(CurrencyUtil.formatter(k));$j("#transferablePL"+h).html(CurrencyUtil.formatter(g))}}})}})();