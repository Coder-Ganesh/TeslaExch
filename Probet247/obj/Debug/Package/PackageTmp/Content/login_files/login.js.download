if(typeof(LoginHandler)=="undefined"){LoginHandler={}}(function(){LoginHandler.init=function(){a();JsCache.get("#loginName").focus();PageConfig.fingerprint=(new TrafficStatistics()).get();PageConfig.fingerprint2="";(new TrafficStatistics2()).get(function(b){PageConfig.fingerprint2=b});PageConfig.fingerprintCanvas=(new TrafficStatistics({canvas:true})).get();PageConfig.fingerprintActiveX=(new TrafficStatistics({ie_activex:true})).get();PageConfig.fingerprintResolution=(new TrafficStatistics({screen_resolution:true})).get();LoginHandler.refreshImgTask.run();TaskExecuter.execute()};LoginHandler.hideUrgentNotice=function(){$j("#urgentNotice").hide()};LoginHandler.check=function(d){WindowEventUtil.stopEvent(d);PageConfig.loginName=$j("#loginName").val();PageConfig.password=$j("#password").val();PageConfig.validCode=$j("#validCode").val();PageConfig.valid=JsCache.get("#valid").val();var b=true;var c="";if(PageConfig.validCode==null||PageConfig.validCode.length==0){b=false;c="msg.error.account.verifyCodeEmpty"}if(PageConfig.password==null||PageConfig.password.length==0){b=false;c="msg.error.account.passwordEmpty"}if(PageConfig.loginName==null||PageConfig.loginName.length==0){b=false;c="msg.error.account.accountEmpty"}if(b){LoginHandler.submit()}else{JsCache.get("#errorMsg").html(I18N.get(c)).show()}};LoginHandler.submit=function(){$j.ajax({type:"POST",url:"/login/agentAuthController/login",data:{loginName:PageConfig.loginName,password:EncryptUtil.mask(EncryptUtil.mask(PageConfig.password)+PageConfig.valid),validCode:PageConfig.validCode,fingerprint:PageConfig.fingerprint,fingerprint2:PageConfig.fingerprint2,fingerprintCanvas:PageConfig.fingerprintCanvas,fingerprintActiveX:PageConfig.fingerprintActiveX,fingerprintResolution:PageConfig.fingerprintResolution},success:function(b){if(b&&b.error){if(b.new_valid){JsCache.get("#valid").val(b.new_valid)}var f;if(b.error[0]=="["){f="";var d=JSON.parse(b.error);for(var e in d){f=d[e]}}else{f=b.error}JsCache.get("#errorMsg").html(f).show();LoginHandler.refreshImgTask.refresh();return}if(b.resetPW=="true"){window.location.replace("/login/agent/passwordOnSignIn.jsp");return}var g=PageConfig.ENABLE_LOGIN_CHANGE_LINE?b.goTo:b.redirect;if(typeof(GoogleAnalyticsHandler)!="undefined"&&GoogleAnalyticsHandler.isEnable(PageConfig.webSiteType)){if(PageConfig.ENABLE_TERMS_CONDITIONS_PAGE&&g.indexOf("termsconditions.jsp")!=-1){}else{GoogleAnalyticsHandler.loginSuccess(PageConfig.loginName)}}if(!PageConfig.ENABLE_LOGIN_CHANGE_LINE){if(b.redirect){location.href=b.redirect}return}if(!b.z||!b.e){window.top.location=b.goTo;return}var i=window.location.hostname;if(i.indexOf("aws.")==0){window.top.location=b.goTo;return}PageConfig.goTo=b.goTo;PageConfig.z=b.z;PageConfig.e=b.e;PageConfig.eDefault=b.eDefault;PageConfig.port=b.port;for(var h=0;h<PageConfig.eDefault.length;h++){ImagePreload.loadImage(PageConfig.eDefault[h].host)}},error:function(d,b,c){Trace.log(d.status);Trace.log(c);LoginHandler.refreshImgTask.refresh();return}})};function a(){$j(document).keydown(function(b){if(KeyEventUtils.isEnterKey(b.keyCode)){$j("#loginBtn").click()}});JsCache.get("#authenticateImage").bind("click",function(){LoginHandler.refreshImgTask.refresh()})}LoginHandler.refreshImgTask=TaskExecuter.createTask(60,0,function(){var b=this;LoginHandler.refreshImg(b)});LoginHandler.refreshImg=function(b){if(b==null){return}reloadImg("authenticateImage");b.check();TaskExecuter.execute()}})();