if(typeof(BankingHandler)=="undefined"){BankingHandler={}}(function(){BankingHandler.init=function(){if(PageConfig.paymentMode==PaymentModeType.CREDIT.value){JsCache.get("#bankingCreditLimitDL").show()}else{if(PageConfig.paymentMode==PaymentModeType.MIX.value){JsCache.get("#bankingCreditPLDL").show()}else{return false}}a();BankingHandler.changeAction("deposit")};BankingHandler.showDialog=function(d,c,b){$j.ajax({type:"POST",url:"/agent/memberManagementController/queryAccount",data:{userID:c,site:b,action:"queryCreditBalance"},beforeSend:function(){JsCache.get("#loading").show()},complete:function(){JsCache.get("#loading").hide()},success:function(e){if(e.error){NoticeHandler.error(e.error)}else{JsCache.get("#displayName").text(e.displayName);CurrencyUtil.updateSetting({currencySymbol:""});JsCache.get("#bankingBalance").html(CurrencyUtil.formatter(e.balance)).append(" <span >("+e.currency+")</span>");JsCache.get("#bankingCreditPL").html(CurrencyUtil.formatter(e.creditPL)).append(" <span >("+e.currency+")</span>");JsCache.get("#editCreditLimit").html(CurrencyUtil.formatter(e.creditLimit)).append(" <span >("+e.currency+")</span>");JsCache.get("#bankingModal").delegate("#bankingBtn","click",function(){if($j(this).hasClass("disable")){return}BankingHandler.editCredit(d,c,b)});$j(document).bind("keydown",function(f){if(KeyEventUtils.isEnterKey(f.keyCode)){$j("#bankingBtn").click()}});JsCache.get("#bankingModal").show()}}})};BankingHandler.hideDialog=function(){JsCache.get("#bankingModal").hide();$j(document).unbind("keydown");JsCache.get("#bankingModal").undelegate("#bankingBtn","click");JsCache.get("#displayName").html("");JsCache.get("#balance").html("");JsCache.get("#amount").val("");JsCache.get("#amount").removeClass("error");JsCache.get("#remarks").val("");JsCache.get("#bankingPassword").val("");JsCache.get("#bankingPassword").removeClass("error")};BankingHandler.editCredit=function(c,k,b){try{var f=$j('#bankingModal input:radio:checked[name="bankingAmount"]').val();var g=0;if(f==="cus"){var g=$j("#amount").val();if(ValidateDataUtil.isEmpty(g)||isNaN(g)||!MathUtil.isPositive(g)||g==0){JsCache.get("#amount").addClass("error");throw new NotValidException(I18N.get("msg.error.validation.transferAmountIsNotValid"))}}var i=$j("#remarks").val();var j=$j("#bankingPassword").val();if(ValidateDataUtil.isEmpty(j)){JsCache.get("#bankingPassword").addClass("error");throw new NotValidException(I18N.get("msg.error.account.passwordEmpty"))}j=EncryptUtil.mask(j);var d=typeof(BankingHandler.updateInfo)=="function";$j.ajax({type:"POST",url:"/agent/memberManagementController/updateBalance",data:{action:BankingHandler.action,amountOption:f,amount:g,bankingPassword:j,userID:k,site:b,remarks:i,infoUpdate:d},beforeSend:function(){JsCache.get("#loading").show();$j("#bankingBtn").addClass("disable")},complete:function(){JsCache.get("#loading").hide();$j("#bankingBtn").removeClass("disable")},success:function(n){if(n.error!=null){var l;if(n.error[0]=="["){l="";var e=JSON.parse(n.error);for(var m in e){l+=e[m]+"\n"}}else{l=n.error}NoticeHandler.error(l)}else{if(d){BankingHandler.updateInfo(c,n)}CurrencyUtil.updateSetting({currencySymbol:PageConfig.currencySymbol});JsCache.get("#mainBalance").html(PageConfig.CurrencyTypeName+" "+CurrencyUtil.formatter(n.mainBalance));BankingHandler.hideDialog();NoticeHandler.success(BankingHandler.action.charAt(0).toUpperCase()+BankingHandler.action.slice(1)+" "+I18N.get("msg.agent.success"))}},error:function(m,e,l){Trace.log(m.status);Trace.log(l);return}})}catch(h){JsCache.get("#bankingPassword").val("");NoticeHandler.error(h.message)}};BankingHandler.changeAction=function(b){BankingHandler.action=b;if(b==="deposit"){JsCache.get("#bankingTitle").text(I18N.get("form.text.agent.editCredit.AddCreditInto"));JsCache.get("#deposit").addClass("select bg_green");JsCache.get("#withdraw").removeClass();JsCache.get("#allAmountOption").hide();JsCache.get("#cusAmountOption").removeClass("radio_enter");JsCache.get("#bankingAmountMust").appendTo("#cusAmountOption");JsCache.get("#cusAmount").hide().click();JsCache.get("#amount").removeClass("error");JsCache.get("#amount").focus();JsCache.get("#bankingBtn").text(I18N.get("form.text.agent.editCredit.creditIn"))}else{JsCache.get("#bankingTitle").text(I18N.get("form.text.agent.editCredit.ReduceCreditOf"));JsCache.get("#withdraw").addClass("select bg_red");JsCache.get("#deposit").removeClass();JsCache.get("#allAmountOption").show();JsCache.get("#bankingAmountMust").appendTo("#allAmountOption");JsCache.get("#cusAmountOption").addClass("radio_enter");JsCache.get("#cusAmount").show().click();JsCache.get("#amount").removeClass("error");JsCache.get("#amount").focus();JsCache.get("#bankingBtn").text(I18N.get("form.text.agent.editCredit.creditOut"))}};function a(){JsCache.get("#deposit").click(function(){BankingHandler.changeAction("deposit")});JsCache.get("#withdraw").click(function(){BankingHandler.changeAction("withdraw")});JsCache.get("#allAmount").click(function(){JsCache.get("#amount").attr("disabled",true);JsCache.get("#amount").removeClass("error")});JsCache.get("#cusAmount").click(function(){JsCache.get("#amount").attr("disabled",false)});$j("#amount").keydown(function(c){var b=$j(this).val().trim();if(!KeyEventUtils.checkNumberKeyAndValue(c,false,true,2,b)){return false}})}})();