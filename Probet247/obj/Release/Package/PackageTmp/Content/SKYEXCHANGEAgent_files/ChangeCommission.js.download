if(typeof(ChangeCommissionHandler)=="undefined"){ChangeCommissionHandler={}}(function(){ChangeCommissionHandler.obj={columnID:"",def:2};ChangeCommissionHandler.init=function(b,a){if(typeof(b)=="undefined"){b="newCommission"}ChangeCommissionHandler.obj.columnID="#"+b;ChangeCommissionHandler.obj.def=a;JsCache.get(ChangeCommissionHandler.obj.columnID).val(a);ChangeCommissionHandler.bindEvent()};ChangeCommissionHandler.bindEvent=function(){JsCache.get(ChangeCommissionHandler.obj.columnID).keyup(function(a){if(!KeyEventUtils.isEnterKey(a.keyCode)){var c=$j(this);var b=c.val();if(!ValidateDataUtil.isEmpty(b)){if(ChangeCommissionHandler.checkData(c)){NoticeHandler.hide();c.removeClass("error")}}else{NoticeHandler.hide();c.removeClass("error")}}});JsCache.get(ChangeCommissionHandler.obj.columnID).blur(function(){var b=$j(this);var a=b.val();if(ValidateDataUtil.isEmpty(a)||isNaN(a)){b.val(ChangeCommissionHandler.obj.def);b.removeClass("error")}})};ChangeCommissionHandler.showDialog=function(){JsCache.get("#newCommission").val(PageConfig.member.commission);JsCache.get("#changeCommissionModal").delegate("#changeCommissionBtn","click",function(){ChangeCommissionHandler.check(PageConfig.member.userID,PageConfig.member.site)});$j(document).bind("keydown",function(a){if(KeyEventUtils.isEnterKey(a.keyCode)){$j("#changeCommissionBtn").click()}});JsCache.get("#changeCommissionModal").show()};ChangeCommissionHandler.hideDialog=function(){JsCache.get("#changeCommissionModal").hide();$j(document).unbind("keydown");JsCache.get("#changeCommissionModal").undelegate("#changeCommissionBtn","click");JsCache.get("#newCommission").val("");JsCache.get("#newCommission").removeClass("error");JsCache.get("#changeCommissionPassword").val("");JsCache.get("#changeCommissionPassword").removeClass("error")};ChangeCommissionHandler.check=function(c,b){try{var d=ChangeCommissionHandler.getData();if(typeof(d)=="undefined"){return false}var a=$j("#changeCommissionPassword").val();if(ValidateDataUtil.isEmpty(a)){JsCache.get("#changeCommissionPassword").addClass("error");throw new NotValidException(I18N.get("msg.error.account.passwordEmpty"))}a=EncryptUtil.mask(a);$j.ajax({type:"POST",url:"/agent/memberManagementController/changeCommission",data:{userID:c,site:b,commission:d,commissionPassword:a},beforeSend:function(){JsCache.get("#loading").show()},complete:function(){JsCache.get("#loading").hide()},success:function(i){if(i.error!=null){var g;if(i.error[0]=="["){g="";var e=JSON.parse(i.error);for(var h in e){g+=e[h]+"\n"}}else{g=i.error}JsCache.get("#changeCommissionPassword").val("");NoticeHandler.error(g)}else{PageConfig.member.commission=i.commission;JsCache.get("#commission").html(PageConfig.member.commission+"%");ChangeCommissionHandler.hideDialog();NoticeHandler.success(I18N.get("msg.executeSuccessful.executeSuccessfully"))}},error:function(h,e,g){Trace.log(h.status);Trace.log(g);return}})}catch(f){JsCache.get("#changeCommissionPassword").val("");NoticeHandler.error(f.message)}};ChangeCommissionHandler.getData=function(){var a=$j(ChangeCommissionHandler.obj.columnID);if(ChangeCommissionHandler.checkData(a)){return a.val()}};ChangeCommissionHandler.checkData=function(f){var a=f.val().trim();var b=f.parent().prev().text().trim();try{if(ValidateDataUtil.isEmpty(a)||isNaN(a)){throw new NotValidException(I18N.get("msg.error.validation.mustBeNumber",[b]))}if(!MathUtil.isPositive(a)){throw new NotValidException(I18N.get("msg.error.validation.positive",[b]))}if(a<PageConfig.agentComm){throw new NotValidException(I18N.get("msg.error.validation.notLess",[PageConfig.agentComm,b]))}if(a>99){throw new NotValidException(I18N.get("msg.error.validation.notGreater",[99,b]))}var c=a.split(".");if(c.length>0&&c.length<=2){if(c.length==2&&c[1].length>1){f.val(MathUtil.floorp(a,1))}}else{throw new NotValidException(I18N.get("msg.error.validation.decimalError",[3,2,1,b]))}f.removeClass("error");return true}catch(d){f.addClass("error");NoticeHandler.error(d.message);return false}}})();