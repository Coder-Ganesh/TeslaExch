if(typeof(CreditReferenceHandler)=="undefined"){CreditReferenceHandler={}}(function(){CreditReferenceHandler.seq=null;CreditReferenceHandler.userId=null;CreditReferenceHandler.site=null;CreditReferenceHandler.init=function(){$j("#changeCreditReferenceBtn").click(function(){try{a()}catch(b){JsCache.get("#changeCreditReferencePassword").val("");NoticeHandler.error(b.message)}});$j("#creditReferenceLog").click(function(){var c={};c.userID=CreditReferenceHandler.userId;c.site=CreditReferenceHandler.site;var b=window.open("/agent/banking/creditReferenceLog.jsp?"+$j.param(c),"creditReferenceLog",config="height=650,width=600,location=no,scrollbars=no");b.focus()})};CreditReferenceHandler.showDialog=function(b,d,c){CreditReferenceHandler.seq=b;CreditReferenceHandler.userId=d;CreditReferenceHandler.site=c;var e=$j("#creditRef"+b).find("#creditRefBtn").data("amount");$j("#creditReference").html(e);$j("#newCreditReference").val(e);$j("#creditReferenceModel").show();$j(document).keydown(function(f){if(KeyEventUtils.isEnterKey(f.keyCode)){$j("#changeCreditReferenceBtn").click()}})};CreditReferenceHandler.hideDialog=function(){CreditReferenceHandler.userId=null;CreditReferenceHandler.site=null;$j("#creditReferenceModel").hide();$j("#newCreditReference").val("");$j("#newCreditReference").removeClass("error");$j("#changeCreditReferencePassword").val("");$j("#changeCreditReferencePassword").removeClass("error");$j(document).unbind("keydown")};function a(){var d=$j("#newCreditReference");var b=d.val().trim();if(isNaN(b)){d.addClass("error");d.focus();throw new NotValidException(I18N.get("msg.error.validation.mustBeNumber",["Credit Reference"]))}d.removeClass("error");var c=$j("#changeCreditReferencePassword").val();if(ValidateDataUtil.isEmpty(c)){$j("#changeCreditReferencePassword").addClass("error");throw new NotValidException(I18N.get("msg.error.account.passwordEmpty"))}c=EncryptUtil.mask(c);$j.ajax({type:"POST",url:"/agent/memberManagementController/updateCreditReference",data:{userId:CreditReferenceHandler.userId,site:CreditReferenceHandler.site,amount:b,changeCreditReferencePassword:c},beforeSend:function(){JsCache.get("#loading").show()},complete:function(){JsCache.get("#loading").hide()},success:function(h){if(h.error){JsCache.get("#changeCreditReferencePassword").val("");NoticeHandler.error(h.error);return}CurrencyUtil.updateSetting({currencySymbol:""});var i=h;var e=$j("#creditRef"+CreditReferenceHandler.seq).find("#creditRefBtn");e.data("amount",i);e.html(CurrencyUtil.formatter(h));var g=IndexHandler.data[CreditReferenceHandler.seq];var f=MathUtil.decimal.subtract(g.balance,i);$j("#refPL"+CreditReferenceHandler.seq).html(CurrencyUtil.formatter(f));CreditReferenceHandler.hideDialog();NoticeHandler.success(I18N.get("msg.executeSuccessful.executeSuccessfully"))},error:function(g,e,f){Trace.log(g.status);Trace.log(f)}})}})();