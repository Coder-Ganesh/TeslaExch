
@{
    Layout = "~/Views/Shared/_LayoutAgent.cshtml";
}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://unpkg.com/sweetalert2@7.18.0/dist/sweetalert2.all.js"></script>
<style>
    [data-tooltip]:before {
        /* needed - do not touch */
        content: attr(data-tooltip);
        position: absolute;
        opacity: 0;
        /* customizable */
        transition: all 0.15s ease;
        padding: 10px;
        color: #333;
        border-radius: 10px;
        box-shadow: 2px 2px 1px silver;
    }

    [data-tooltip]:hover:before {
        /* needed - do not touch */
        opacity: 1;
        /* customizable */
        background: yellow;
    }

    [data-tooltip]:not([data-tooltip-persistent]):before {
        pointer-events: none;
    }
</style>

<div id="mainWrap" class="main_wrap">
    <div class="total_all">
        <div class="agent_path">
            <ul id="agentPath" class="agent_path-L" style="display: none;">

                <li id="path6" class="" style="display: none;">
                    <a href="javascript: void(0);">
                        <span class="lv_0">
                            COM
                        </span>
                        <strong></strong>
                    </a>
                </li>

                <li id="pathCurrency" class="currency_tag" style="display: none;">
                    <a href="javascript: void(0);">
                        <span class=""></span>
                        <strong></strong>
                    </a>
                </li>

                <li id="path5" class="" style="display: none;">
                    <a href="javascript: void(0);">
                        <span class="lv_1">
                            SS
                        </span>
                        <strong></strong>
                    </a>
                </li>

                <li id="path4" class="" style="display: none;">
                    <a href="javascript: void(0);">
                        <span class="lv_2">
                            SUP
                        </span>
                        <strong></strong>
                    </a>
                </li>

                <li id="path3" class="last_li" style="">
                    <a href="javascript: void(0);">
                        <span class="lv_3">
                            MA
                        </span>
                        <strong>login_username</strong>
                    </a>
                </li>

                <li id="path0" class="" style="display: none;">
                    <a href="javascript: void(0);">
                        <span class="lv_4">
                            PL
                        </span>
                        <strong></strong>
                    </a>
                </li>

                <ul class="account_pop" id="accountPop" style="">
                    <li id="popTmp" style="display: none;">
                        <a href="#"></a>
                    </li>
                </ul>
            </ul>
        </div>

        <a id="refresh" class="btn_replay"><img src="~/Content/SKYEXCHANGEAgent_files/transparent.gif" /></a>

        <a class="add_member" href="#" onclick="AddPlayerDialog()">
            <img src="~/Content/SKYEXCHANGEAgent_files/transparent.gif" />Add Player
        </a>
    </div>
    <div id="totalBox" class="total_box" style="display:none;">
        <dl id="totalBalanceDL" class="total_dl" style="width: 10%">
            <dt>Total Balance</dt>
            <dd id="totalBalance">
                BAL @ViewBag.ToBala
            </dd>
        </dl>
        <dl id="totalExposureDL" class="total_dl" style="width: 10%">
            <dt>Total Exposure</dt>
            <dd id="totalExposure">BAL @ViewBag.ToExp</dd>
        </dl>

        <dl id="availableBalanceDL" class="total_dl" style="width: 10%">
            <dt>Total Avail. bal.</dt>
            <dd id="totalAvailBal">BAL @ViewBag.ToAvBal</dd>
        </dl>
        <dl id="masterBalanceDL" class="total_dl" style="width: 10%">
            <dt>Balance</dt>
            <dd id="mastersBalance">BAL  @ViewBag.Balan</dd>
        </dl>
        <dl id="masterAvailableBalanceDL" class="total_dl" style="width: 10%">
            <dt>Available Balance</dt>
            <dd id="mastersAvailBal">BAL @ViewBag.AVBAH</dd>
        </dl>
        <dl id="masterAvailableBalanceDL" class="total_dl" style="width: 10%;display:none;">
            <dt>Net Profit Loss</dt>
            <dd id="mastersAvailBal">BAL @ViewBag.prof_llo</dd>
        </dl>

    </div>
    <div class="function-wrap clearfix">
        <dl class="banking-head float-L">
            <dd><a href="/Agent/Index/A">A</a></dd>
            <dd><a href="/Agent/Index/B">B</a></dd>
            <dd><a href="/Agent/Index/C">C</a></dd>
            <dd><a href="/Agent/Index/D">D</a></dd>
            <dd><a href="/Agent/Index/E">E</a></dd>
            <dd><a href="/Agent/Index/F">F</a></dd>
            <dd><a href="/Agent/Index/G">G</a></dd>
            <dd><a href="/Agent/Index/H">H</a></dd>
            <dd><a href="/Agent/Index/I">I</a></dd>
            <dd><a href="/Agent/Index/J">J</a></dd>
            <dd><a href="/Agent/Index/K">K</a></dd>
            <dd><a href="/Agent/Index/L">L</a></dd>
            <dd><a href="/Agent/Index/M">M</a></dd>
            <dd><a href="/Agent/Index/N">N</a></dd>
            <dd><a href="/Agent/Index/O">O</a></dd>
            <dd><a href="/Agent/Index/P">P</a></dd>
            <dd><a href="/Agent/Index/Q">Q</a></dd>
            <dd><a href="/Agent/Index/R">R</a></dd>
            <dd><a href="/Agent/Index/S">S</a></dd>
            <dd><a href="/Agent/Index/T">T</a></dd>
            <dd><a href="/Agent/Index/U">U</a></dd>
            <dd><a href="/Agent/Index/V">V</a></dd>
            <dd><a href="/Agent/Index/W">W</a></dd>
            <dd><a href="/Agent/Index/X">X</a></dd>
            <dd><a href="/Agent/Index/Y">Y</a></dd>
            <dd><a href="/Agent/Index/Z">Z</a></dd>
            <dd><a href="/Agent/Index/All">All</a></dd>
        </dl>
        <div class="wrap">
            <div class="search">
                <input type="text" class="searchTerm" placeholder="Enter Player Name" style="margin:0px;">
                <button type="submit" class="searchButton">
                    <i class="fa fa-search"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Center Column -->
    <div id="widthAll" class="width-all">


        <!-- Loading Wrap -->
        <div id="loading" class="loading-wrap" style="display: block;">
            <ul class="loading">
                <li><img src="~/Content/SKYEXCHANGEAgent_files/prospin.gif" /></li>
                <li>Loading...</li>
            </ul>
        </div>

        <!-- Message -->
        <div id="message" class="message-wrap success">
            <a class="btn-close" id="messageBtnClose">Close</a>
            <p></p>
        </div>
        <!-- Report Table -->
        <table id="resultTable" class="table01 margin-table" style="display: table;">
            <tbody>
            <thead>
            <th id="accountTh" class="align-L" style="">Account</th>
            <th id="balanceTh" width="10%" style="">Credit Ref.</th>
            <th id="balanceTh" width="10%" style="">Balance</th>
            <th id="exposureTh" width="10%" style="">Exposure</th>
            <th id="availableBalanceTh" width="10%" style="">Avail. bal.</th>
            <th id="refPLTh" width="10%" style="display:none;">Net D/W</th>
            <th id="refPLTh" width="10%" style="">Exposure limit</th>
            <th id="refPLTh" width="10%" style="">Ref. P/L</th>
            <th id="statusTh" width="10%" style="">Status</th>
            <th id="actionTh" width="15%" style="">Action</th>
            </thead>
            @{Double cpl = 0;}
            @foreach (var item in Model)
            {
                var hdh = "display:none;";
                if (@item.is_bet == "no")
                {
                    hdh = "";
                }
                <tr id="0" style="display: table-row;">
                    <td id="accountCol" class="align-L"><span class="lv_4">PL</span>@item.Client_Username <i class="fa fa-lock fa_custom fa-2x" aria-hidden="true" style="color:red;font-size: 14px!important; @hdh"></i></td>
                    <td id="refPL0" style="">
                        <input type="hidden" id="credit_@item.Client_Id" value="@item.credit_ref" />
                        <a id="creditRef0" class="credit-amount-member" href="javascript:void(0);" onclick="openCreditDialog(@item.Client_Id)">
                            @item.credit_ref
                        </a>
                    </td>
                    <td id="balance0" style="">@item.Client_balance</td>
                    <td id="currentExposure0" style=""> <a href="javascript:" style="text-decoration: none;" onclick="Exposurelistshow('/Agent/ClientLiability/@item.Client_Id'); return false;">@item.Client_exposure</a></td>
                    <td id="available0" style="">@item.Client_avl_balance</td>
                    <td id="refPL0" style="display:none;">@item.Client_ttl_balance</td>
                    <td id="refPL0" style="">@item.exposure_limit</td>
                    @if (item.Client_profit_loss < 0)
                    {
                        cpl = -item.Client_profit_loss;
                        <td id="userExposure"><span class="red">( @cpl)</span></td>
                    }
                    else
                    {
                        <td id="refPL0" style="">@item.Client_profit_loss</td>
                    }

                    <td id="statusCol" style="">
                        <ul id="tipsPopup" class="status-popup" style="display: none">
                        </ul>
                        @if (item.Client_status == "activate")
                        {
                            <span id="status" class="status-active"><img src="~/Content/SKYEXCHANGEAgent_files/transparent.gif">Active</span>
                        }
                        else
                        {
                            <span id="status" class="status-suspend"><img src="~/Content/SKYEXCHANGEAgent_files/transparent.gif">Suspend</span>
                        }
                    </td>
                    <td id="actionCol" style="">
                        <ul class="action">
                            <li data-tooltip="Banking">
                                <a  id="banking" class="bank" href="#" onclick="bankingModal(@item.Client_Id);">Bank</a>
                            </li>
                            <li data-tooltip="change Password">
                                <i class="fa fa-key" aria-hidden="true" style="display:block;padding: 6px; border: 1px solid #bbb; border-radius: 5px; font-weight: bold; background: #f2f2f2;     margin-left: 3px;" onclick="ChangePasswordHandlerDialog(@item.Client_Id);"></i>
                            </li>
                            <li data-tooltip="P&L">
                                <a id="p_l0" class="p_l" href="/Agent/profitAndLoss/@item.Client_Id">Betting Profit &amp; Loss</a>
                            </li>
                            <li data-tooltip="Bet History">
                                <a id="betting_history0" class="betting_history" href="/Agent/betList/@item.Client_Id">Betting History</a>
                            </li>
                            <li data-tooltip="Bet Lock & Change Status">
                                <input type="hidden" id="Username_@item.Client_Id" value="@item.Client_Username" />
                                <input type="hidden" id="status_@item.Client_Id" value="@item.Client_status" />
                                <a id="change0" class="status" href="#" onclick="openStatusDialog(@item.Client_Id)">Change Status</a>
                            </li>
                            <li>
                                <a id="profile0" class="profile" href="/Agent/accountSummary/@item.Client_Id">Profile</a>
                            </li>
                        </ul>
                    </td>
                </tr>
            }


            </tbody>
        </table>
    </div>

    <!-- Report Table -->
    <div id="tableOneBox" class="table_one_box" style="display: none">


    </div>
</div>

<script>
    function Exposurelistshow(relativeUrl, user_id) {
        var param = { 'user_id': user_id };
        OpenWindowWithPost(relativeUrl, "width=1200, height=600, left=100, top=100, resizable=yes, scrollbars=yes", "NewFile", param);
    }


    function OpenWindowWithPost(url, windowoption, name, params) {
        var form = document.createElement("form");
        form.setAttribute("method", "post");
        form.setAttribute("action", url);
        form.setAttribute("target", name);
        for (var i in params) {
            if (params.hasOwnProperty(i)) {
                var input = document.createElement('input');
                input.type = 'hidden';
                input.name = i;
                input.value = params[i];
                form.appendChild(input);
            }
        }
        document.body.appendChild(form);
        //note I am using a post.htm page since I did not want to make double request to the page
        //it might have some Page_Load call which might screw things up.
        window.open("/Agent/Index/", name, windowoption);
        form.submit();
        document.body.removeChild(form);
    }

    /////// search filliter js////////

    $(document).ready(function () {
        $('.searchTerm').on('keyup', function () {
            var searchTerm = $(this).val().toLowerCase();
            $('#resultTable tbody tr').each(function () {
                var lineStr = $(this).text().toLowerCase();
                if (lineStr.indexOf(searchTerm) === -1) {
                    $(this).hide();
                } else {
                    $(this).show();
                }
            });
        });
    });
</script>
<script>
    function bankingModal(idd) {
        $("#uidban").val(idd);
        $("#bankingModal").show();
    }
    function BankingHandler() {
        $("#bankingModal").hide();
    }
    function ChangePasswordHandlerDialog(uid) {
        $("#uiidis").val(uid);
        $('#changePasswordModal').show();
    }
    $('#messageBtnClose').click(function () {
        $('#message').hide();
    });

    function changePasswordRequest() {
        var newPassword = $("#newPassword").val();
        var uiidis = $("#uiidis").val();
        var newPasswordConfirm = $("#newPasswordConfirm").val();
        var changePassword = $("#changePassword").val();
        var letters = /^(?=.*[0-9])(?=.*[a-zA-Z])([a-zA-Z0-9]+)$/;

        if (newPassword == "") {
            $("#messageBtnClose").show();
            $("#message").addClass("error");
            $("#message").show();
            $("#message p").text("The field is required: New Password");
            setTimeout(function () { $("#message").hide(); }, 2000);
        }
        else if (letters.test(newPassword) === false || newPassword.length > 15 || newPassword.length < 8) {
            $("#messageBtnClose").show();
            $("#message").addClass("error");
            $("#message").show();
            $("#message p").text("Password must have 8 to 15 alphanumeric without white space and must not contain any special characters (!,#,etc..): New Password");
            setTimeout(function () { $("#message").hide(); }, 2000);
        }

        else if (changePassword == "") {
            $("#messageBtnClose").show();
            $("#message").addClass("error");
            $("#message").show();
            $("#message p").text("The field is required: Your Password");
            setTimeout(function () { $("#message").hide(); }, 2000);
        }
        else {
            $.ajax({
                type: 'POST',
                url: '/FunctionData/ClientChangePasswordDB',
                data: { user_id: uiidis, newPassword: newPassword },
                beforeSend: function () {
                    $("#changePasswordBtn").prop('disabled', true);
                    $("#changePasswordBtn").html('Please Wait...');
                },
                error: function () {
                    setTimeout(function () {
                        //btn.prop('disabled', false);
                        $("#messageBtnClose").show();
                        $("#message").addClass("error");
                        $("#message").show();
                        $("#message p").text('Error change password, please try again.');
                        setTimeout(function () { $("#message").hide(); }, 2000);
                        $("#changePasswordBtn").prop('disabled', false);
                        $("#changePasswordBtn").html('Change');
                    }, 1000);
                },
                success: function (result) {
                    // alert(result);
                    setTimeout(function () {

                        $("#changePasswordBtn").prop('disabled', false);
                        $("#changePasswordBtn").html('Change');
                        if (result == "Success") {

                            $("#messageBtnClose").show();
                            $("#message").addClass("success");
                            $("#message").show();
                            $("#message p").text('Password changed successfully!');
                            setTimeout(function () {
                                $("#message").hide();
                                window.location.href = '';
                            }, 2000);
                        }
                        else if (result == "IncorrectPWD") {

                            $("#messageBtnClose").show();
                            $("#message").addClass("error");
                            $("#message").show();
                            $("#message p").text('Incorrect Password!');
                            setTimeout(function () { $("#message").hide(); }, 2000);
                        }
                        else {
                            $("#messageBtnClose").show();
                            $("#message").addClass("error");
                            $("#message").show();
                            $("#message p").text('Error change password, please try again.');
                            setTimeout(function () { $("#message").hide(); }, 2000);
                        }
                    }, 1000);
                }
            });
        }
    }

    function DWAmount() {
        var amount = $("#amount").val();
        var remark = $("#remark").val();
        var uidban = $("#uidban").val();
        if (amount == "") {
            $("#messageBtnClose").show();
            $("#message").addClass("error");
            $("#message").show();
            $("#message p").text("The field is required: Amount");
            setTimeout(function () { $("#message").hide(); }, 2000);
        }
        else if (isNaN(amount) === true || amount < 0 || amount == 0) {
            $("#messageBtnClose").show();
            $("#message").addClass("error");
            $("#message").show();
            $("#message p").text("Please enter valid amount.");
            setTimeout(function () { $("#message").hide(); }, 2000);
        }
        else {
            swal({
                title: '',
                text: "Are you sure you want to deposit amount?",
                type: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes'
            }).then((result) => {
                if (result.value) {
                    $.ajax({
                        type: 'POST',
                        url: '/AgentLogin_DB/ClientDepositCoins',
                        data: { user_id: uidban, coins: amount, remark1: remark },
                        beforeSend: function () {
                            $("#deposit").prop('disabled', true);
                            $("#deposit").html('Please Wait...');
                        },
                        error: function () {
                            setTimeout(function () {
                                //btn.prop('disabled', false);
                                $("#messageBtnClose").show();
                                $("#message").addClass("error");
                                $("#message").show();
                                $("#message p").text('Error in deposit amount, please try again.');
                                setTimeout(function () { $("#message").hide(); }, 2000);
                                $("#deposit").prop('disabled', false);
                            }, 1000);
                        },
                        success: function (result) {
                            setTimeout(function () {
                                $("#deposit").prop('disabled', false);
                                if (result == "true") {
                                    $("#messageBtnClose").show();
                                    $("#message").addClass("success");
                                    $("#message").show();
                                    $("#message p").text('Amount deposit successfully!');
                                    setTimeout(function () {
                                        $("#message").hide();
                                        window.location.href = '';
                                    }, 2000);
                                }
                                else if (result == "InsufficientAmount") {
                                    $("#messageBtnClose").show();
                                    $("#message").addClass("error");
                                    $("#message").show();
                                    $("#message p").text('Insufficient Coin!');
                                    setTimeout(function () {
                                        $("#message").hide();
                                        window.location.href = '';
                                    }, 2000);
                                }
                                else {
                                    $("#messageBtnClose").show();
                                    $("#message").addClass("error");
                                    $("#message").show();
                                    $("#message p").text('Error in deposit amount, please try again.11');
                                    setTimeout(function () { $("#message").hide(); }, 2000);
                                }
                            }, 1000);
                        }
                    });
                }
            });
        }
    }

    function WDAmount(id) {
        var amount = $("#amount").val();
        var remark = $("#remark").val();
        var uidban = $("#uidban").val();
        var remark2 = "";

        if (amount == "") {
            $("#messageBtnClose").show();
            $("#message").addClass("error");
            $("#message").show();
            $("#message p").text("The field is required: Amount");
            setTimeout(function () { $("#message").hide(); }, 2000);
        }
        else if (isNaN(amount) === true || amount < 0 || amount == 0) {
            $("#messageBtnClose").show();
            $("#message").addClass("error");
            $("#message").show();
            $("#message p").text("Please enter valid amount.");
            setTimeout(function () { $("#message").hide(); }, 2000);
        }
        else {
            swal({
                title: '',
                text: "Are you sure you want to withdraw amount?",
                type: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes'
            }).then((result) => {
                if (result.value) {
                    $.ajax({
                        type: 'POST',
                        url: '/AgentLogin_DB/ClientWithdrawalCoins',
                        data: { user_id: uidban, coins: amount, remark1: remark, remark2: remark2 },
                        beforeSend: function () {
                            $("#withdraw").prop('disabled', true);
                        },
                        error: function () {
                            setTimeout(function () {
                                //btn.prop('disabled', false);
                                $("#messageBtnClose").show();
                                $("#message").addClass("error");
                                $("#message").show();
                                $("#message p").text('Error in withdraw amount, please try again.');
                                setTimeout(function () { $("#message").hide(); }, 2000);
                                $("#withdraw").prop('disabled', false);
                            }, 1000);
                        },
                        success: function (result) {

                            setTimeout(function () {
                                // alert(result);
                                $("#withdraw").prop('disabled', false);
                                if (result == "true") {
                                    $("#messageBtnClose").show();
                                    $("#message").addClass("success");
                                    $("#message").show();
                                    $("#message p").text('Amount withdraw successfully!');
                                    setTimeout(function () {
                                        $("#message").hide();
                                        window.location.href = '';
                                    }, 2000);
                                }
                                else if (result == "InsufficientAmount") {

                                    $("#messageBtnClose").show();
                                    $("#message").addClass("error");
                                    $("#message").show();
                                    $("#message p").text('Insufficient Coin!');
                                    setTimeout(function () {
                                        $("#message").hide();
                                        window.location.href = '';
                                    }, 2000);
                                }
                                else {
                                    $("#messageBtnClose").show();
                                    $("#message").addClass("error");
                                    $("#message").show();
                                    $("#message p").text('Error in withdraw amount, please try again.');
                                    setTimeout(function () { $("#message").hide(); }, 2000);
                                }
                            }, 1000);
                        }
                    });
                }
            });
        }
    }
</script>
