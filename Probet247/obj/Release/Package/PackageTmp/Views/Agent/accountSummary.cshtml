@{
    Layout = "~/Views/Shared/_LayoutAgent.cshtml";
}



<div id="message" class="message-wrap success" style="display: none;">
    <a class="btn-close" id="messageBtnClose">Close</a>
    <p></p>
</div>

<style>
    .pop_bg {
        display: none;
        position: fixed;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.7);
        z-index: 80
    }

        .pop_bg:not(:target) {
            display: none
        }

        .pop_bg:target {
            display: block
        }
</style>
<!-- Change password pop start -->

<div id="exposureLimitModal" class="pop_bg" style="display: none;">
    <div class="pop_box">
        <a class="close_pop" href="javascript: void(0)" onclick="$('#exposureLimitModal').hide();">close_pop</a>

        <h3>Change Exposure Limit</h3>

        <dl class="form_list">
            <dt>Exposure Limit</dt>
            <dd><strong id="exposureLimitText"></strong></dd>

            <dt>Exposure</dt>
            <dd>
                <input id="exposureLimit" type="text" value="" placeholder="Enter" maxlength="12">
                <span class="must">＊</span>
            </dd>
            <dt>Password</dt>
            <dd>
                <input id="exposureLimitPassword" type="password" placeholder="Enter">
                <span class="must">＊</span>
            </dd>
            <dd><a id="exposureLimitBtn" href="javascript: void(0)" onclick="changeExposureRequest()" class="btn-send">Change</a></dd>
        </dl>
    </div>
</div>

<!--<div id="changeCommissionModal" class="pop_bg" style="display:none">
    <div class="pop_box">
        <a class="close_pop" href="javascript: void(0)" onclick="ChangeCommissionHandler.hideDialog()">close_pop</a>

        <h3>Change Commission</h3>

        <dl class="form_list">
            <dt>Commission</dt>
            <dd>
                <input id="newCommission" type="text" onclick="location.href='#stake'" placeholder="Enter">%
                <span class="must">＊</span>
            </dd>
            <dt>Password</dt>
            <dd>
                <input id="changeCommissionPassword" type="password" onclick="location.href='#stake'" placeholder="Enter">
                <span class="must">＊</span>
            </dd>
            <dd><a id="changeCommissionBtn" href="javascript: void(0)" class="btn-send">Change</a></dd>
        </dl>
    </div>
</div>-->
<!--<div id="changeMaxWinLossLimitModal" class="pop_bg" style="display:none;">
    <div class="pop_box">
        <a class="close_pop" href="javascript: void(0)" onclick="ChangeMaxWinLossLimitHandler.hideDialog()">close_pop</a>


        <h3>
            Change Max Win Limit
        </h3>
        <dl class="form_list">

            <dt>
                Max Win Limit
            </dt>
            <dd>
                <input id="newMaxWinLossLimit" type="text" onclick="location.href='#stake'" placeholder="Enter">
                <span class="must">＊</span>
            </dd>

            <dt>
                Password
            </dt>
            <dd>
                <input id="changeMaxWinLossLimitPassword" type="password" onclick="location.href='#stake'" placeholder="Enter">
                <span class="must">＊</span>
            </dd>
            <dd>
                <a id="changeMaxWinLossLimitBtn" href="javascript: void(0)" class="btn-send">
                    Change
                </a>
            </dd>
        </dl>
    </div>
</div>-->
<div class="main_wrap">
    <!-- agent path -->


    <div class="main_wrap">
        <!-- agent path -->

        <div class="agent_path">
            <ul id="agentPath" class="agent_path-L">

                <li id="path6" class="" style="display: none;">
                    <a href="javascript: void(0);">
                        <span class="lv_0">
                            COM
                        </span>
                        <strong></strong>
                    </a>
                </li>

                <li id="pathCurrency" class="currency_tag" style="display: none;">
                    <a href="javascript: void(0);">
                        <span class=""></span>
                        <strong></strong>
                    </a>
                </li>

                <li id="path5" class="" style="display: none;">
                    <a href="javascript: void(0);">
                        <span class="lv_1">
                            SS
                        </span>
                        <strong></strong>
                    </a>
                </li>

                <li id="path4" class="" style="display: none;">
                    <a href="javascript: void(0);">
                        <span class="lv_2">
                            SUP
                        </span>
                        <strong></strong>
                    </a>
                </li>

                <li id="path3" class="" style="">
                    <a href="javascript: void(0);">
                        <span class="lv_3">
                            MA
                        </span>
                        <strong>@Session["DL_UserName"]</strong>
                    </a>
                </li>

                <li id="path0" class="last_li drop_down_li" style="">
                    <a href="javascript: void(0);" onclick="accountPop()">
                        <span class="lv_4">
                            PL
                        </span>
                        <strong>@ViewBag.CUname</strong>
                    </a>
                    <input type="hidden" name="accountPopInput" id="accountPopInput" value="0">
                    <script>
                        function accountPop() {
                            if ($("#accountPopInput").val() == 0) {
                                $("#accountPopInput").val("1");
                                $("#accountPop").show();
                            }
                            else {
                                $("#accountPopInput").val("0");
                                $("#accountPop").hide();
                            }
                        }
                    </script>
                    <ul class="account_pop" id="accountPop" style="display: none;">
                        <li id="popTmp" style="display: none;">
                            <a href=""></a>
                        </li>


                        <li id="userlist1" style="display: list-item;">
                        </li>
                    </ul>
                </li>


            </ul>
        </div>

        <!-- Agent Left Column -->

        <div class="col-left">

            <!-- Sub Menu and Path -->
            <div class="sub_path">

                <!-- Sub Menu -->
                <ul class="menu-list">

                    <li class="class">Position</li>
                    <li>
                        <a id="accountSummary" class="select" href="/Agent/accountSummary/@ViewBag.ClientId">Account Summary</a>
                    </li>

                    <li class="class">Performance</li>

                    <li>
                        <a id="bettingHistory" href="/Agent/betList/@ViewBag.ClientId">Betting History</a>
                    </li>
                    <li>
                        <a id="profitLoss" href="/Agent/profitAndLoss/@ViewBag.ClientId">Betting Profit &amp; Loss</a>
                    </li>


                    <li>
                        <a id="transactionHistory" href="/Agent/transactionHistory/@ViewBag.ClientId">
                            Transaction&nbsp;History
                        </a>
                    </li>
                </ul>
            </div>
        </div>


        <!-- Center Column -->
        <div class="col-center report">


            <!-- Loading Wrap -->
            <div id="loading" class="loading-wrap" style="display:none">
                <ul class="loading">
                    <li><img src="~/Content/images/prospin.gif"></li>
                    <li>Loading...</li>
                </ul>
            </div>

            <!-- Message -->
            <div id="message" class="message-wrap success">
                <a class="btn-close">Close</a>
                <p></p>
            </div>

            <script language="JavaScript" type="text/javascript">
                (function () {
                    $j('.btn-close').click(function () {
                        $j('#message').hide();
                    });
                })();
            </script>

            <h2>Account Summary</h2>

            <ul class="acc-info">
                <li class="user">@ViewBag.UserNameC</li>
                <li class="status_all">
                    <strong id="status"></strong>
                </li>



            </ul>


            <!-- Report Table -->
            <table class="table01">
                <tbody>
                    <tr>
                        <th width="20%" class="align-L">Wallet</th>

                        <th width="25%">Available to Bet</th>
                        <th width="">Funds available to withdraw</th>
                        <th width="25%">Current exposure</th>

                    </tr>

                    <tr>
                        <td class="align-L">Main wallet</td>

                        <td id="availableToBet">@ViewBag.UserBalC</td>
                        <td id="availableToWithDraw">@ViewBag.UserBalC</td>
                        <td id="currentExposure">@ViewBag.UserExpC</td>
                    </tr>
                </tbody>
            </table>

            <h2>Profile</h2>
            <div class="event-left">
                <div class="profile-wrap">
                    <h3>About You</h3>
                    <dl>
                        <dt>Username</dt>
                        <dd>@ViewBag.UserNameC</dd>

                        <dt>Full Name</dt>
                        <dd>@ViewBag.FUserNameC</dd>

                        <dt>Birthday</dt>
                        <dd></dd>

                        <dt>E-mail</dt>
                        <dd></dd>

                        <dt>Password</dt>
                        <dd>
                            *******
                            <a href="#" class="favor-set" onclick="ChangePasswordHandlerDialog()">Edit</a>
                        </dd>

                        <dt>Time Zone</dt>
                        <dd>IST</dd>
                    </dl>
                </div>

                <div class="profile-wrap">
                    <h3>Contact Details</h3>
                    <dl>
                        <dt>Primary number</dt>
                        <dd></dd>
                    </dl>
                </div>
            </div>

            <div class="event-right">

                <div class="profile-wrap" style="">
                    <h3>Limits &amp; Commission</h3>
                    <dl>
                        <dt>Exposure Limit</dt>
                        <dd id="mainwalletExposureLimit"><span id="client_exp_limit">@ViewBag.exp_limit</span><a href="#exposure" class="favor-set" onclick="openExposureDialog()">Edit</a></dd>
                        <!--<dt>Commission</dt>
                        <dd>
                            <span id="commission">0.0%</span>
                            <a href="#exposure" class="favor-set" onclick="ChangeCommissionHandler.showDialog()">Edit</a>
                        </dd>-->
                    </dl>
                </div>
                <div class="profile-wrap" style="display: none;">
                    <h3>PT</h3>
                    <dl>

                        <dt>PT Setting</dt>
                        <dd>

                            <a href="#" class="favor-set" onclick="PTAllowedHandler.showDialog()">Edit</a>

                        </dd>
                        <dd class="dl_list">
                            <img class="expand-arrow" src="/images/transparent.gif">
                            <dl>

                                <dt>Soccer</dt>
                                <dd id="profile_soccer_PT">0%</dd>

                                <dt>Basketball</dt>
                                <dd id="profile_basketball_PT">0%</dd>

                                <dt>American Football</dt>
                                <dd id="profile_american_football_PT">0%</dd>

                                <dt>Cricket</dt>
                                <dd id="profile_cricket_PT">0%</dd>

                                <dt>Horse Racing</dt>
                                <dd id="profile_horse_racing_PT">0%</dd>

                                <dt>Greyhound Racing</dt>
                                <dd id="profile_greyhound_racing_PT">0%</dd>

                                <dt>Rugby Union</dt>
                                <dd id="profile_rugby_union_PT">0%</dd>

                                <dt>Tennis</dt>
                                <dd id="profile_tennis_PT">0%</dd>

                            </dl>
                        </dd>

                        <div style="display: none;">
                            <dt>Fancy Bet PT Setting</dt>
                            <dd></dd>
                            <dd class="dl_list">
                                <img class="expand-arrow" src="/images/transparent.gif">
                                <dl>
                                    <dt>Fancy Bet</dt>
                                    <dd id="profile_company_fancy_bet_PT">0%</dd>
                                </dl>
                            </dd>
                        </div>
                    </dl>
                </div>
            </div>
        </div>
    </div>




    <script>
        function ChangePasswordHandlerDialog() {
            $('#changePasswordModal').show();
        }

        $('#messageBtnClose').click(function () {
            $('#message').hide();
        });

        function changePasswordRequest() {
            var newPassword = $("#newPassword").val();
            var newPasswordConfirm = $("#newPasswordConfirm").val();
            var changePassword = $("#changePassword").val();
            var letters = /^(?=.*[0-9])(?=.*[a-zA-Z])([a-zA-Z0-9]+)$/;

            if (newPassword == "") {
                $("#messageBtnClose").show();
                $("#message").addClass("error");
                $("#message").show();
                $("#message p").text("The field is required: New Password");
                setTimeout(function () { $("#message").hide(); }, 2000);
            }
            else if (letters.test(newPassword) === false || newPassword.length > 15 || newPassword.length < 8) {
                $("#messageBtnClose").show();
                $("#message").addClass("error");
                $("#message").show();
                $("#message p").text("Password must have 8 to 15 alphanumeric without white space and must not contain any special characters (!,#,etc..): New Password");
                setTimeout(function () { $("#message").hide(); }, 2000);
            }
            else if (newPasswordConfirm == "") {
                $("#messageBtnClose").show();
                $("#message").addClass("error");
                $("#message").show();
                $("#message p").text("The field is required: New Password Confirm");
                setTimeout(function () { $("#message").hide(); }, 2000);
            }
            else if (changePassword == "") {
                $("#messageBtnClose").show();
                $("#message").addClass("error");
                $("#message").show();
                $("#message p").text("The field is required: Your Password");
                setTimeout(function () { $("#message").hide(); }, 2000);
            }
            else {
                $.ajax({

                    type: 'POST',
                    url: '/FunctionData/ClientChangePasswordDB',
                    data: { user_id: @ViewBag.UserIdC, newPassword: newPassword, changePassword: changePassword },
                    beforeSend: function () {
                        $("#changePasswordBtn").prop('disabled', true);
                        $("#changePasswordBtn").html('Please Wait...');
                    },
                    error: function () {
                        setTimeout(function () {
                            //btn.prop('disabled', false);
                            $("#messageBtnClose").show();
                            $("#message").addClass("error");
                            $("#message").show();
                            $("#message p").text('Error change password, please try again.');
                            setTimeout(function () { $("#message").hide(); }, 2000);
                            $("#changePasswordBtn").prop('disabled', false);
                            $("#changePasswordBtn").html('Change');
                        }, 1000);
                    },
                    success: function (result) {
                        // alert(result);
                        setTimeout(function () {

                            $("#changePasswordBtn").prop('disabled', false);
                            $("#changePasswordBtn").html('Change');
                            if (result == "Success") {

                                $("#messageBtnClose").show();
                                $("#message").addClass("success");
                                $("#message").show();
                                $("#message p").text('Password changed successfully!');
                                setTimeout(function () {
                                    $("#message").hide();
                                    window.location.href = '';
                                }, 2000);
                            }
                            else if (result == "IncorrectPWD") {

                                $("#messageBtnClose").show();
                                $("#message").addClass("error");
                                $("#message").show();
                                $("#message p").text('Incorrect Password!');
                                setTimeout(function () { $("#message").hide(); }, 2000);
                            }
                            else {
                                $("#messageBtnClose").show();
                                $("#message").addClass("error");
                                $("#message").show();
                                $("#message p").text('Error change password, please try again.');
                                setTimeout(function () { $("#message").hide(); }, 2000);
                            }
                        }, 1000);
                    }
                });
            }
        }

        function openExposureDialog() {
            var exp_limit = $("#client_exp_limit").text();
            $("#exposureLimitModal").show();
            $("#exposureLimitText").text(exp_limit);
        }

        function changeExposureRequest() {
            var password = $("#exposureLimitPassword").val();
            var exposure_limit = $("#exposureLimit").val();
            var old_exp_limit = $("#exposureLimitText").text();
            if (exposure_limit == "") {
                $("#messageBtnClose").show();
                $("#message").addClass("error");
                $("#message").show();
                $("#message p").text("Enter Correct Amount");
                setTimeout(function () { $("#message").hide(); }, 2000);
            }
            else {
                $.ajax({
                    type: 'POST',
                    url: '/AgentLogin_DB/Expo_limit',
                    data: { exp_id: @ViewBag.UserIdC, password: password, exposure_limit: exposure_limit,old_exp_limit:old_exp_limit},
                    beforeSend: function () {
                        $("#changeCreditReferenceBtn").prop('disabled', true);
                        $("#changeCreditReferenceBtn").html('Please Wait...');
                    },
                    error: function () {
                        setTimeout(function () {
                            //btn.prop('disabled', false);
                            $("#messageBtnClose").show();
                            $("#message").addClass("error");
                            $("#message").show();
                            $("#message p").text('Error in Change Exposure Limit, please try again.');
                            setTimeout(function () { $("#message").hide(); }, 2000);
                            $("#changeCreditReferenceBtn").prop('disabled', false);
                            $("#changeCreditReferenceBtn").html('Change');
                        }, 1000);
                    },
                    success: function (result) {
                        //alert(result)
                        setTimeout(function () {

                            $("#changeCreditReferenceBtn").prop('disabled', false);
                            $("#changeCreditReferenceBtn").html('Change');
                            if (result == "Success") {

                                $("#messageBtnClose").show();
                                $("#message").addClass("success");
                                $("#message").show();
                                $("#message p").text('Player Exposure Limit Changed successfully!');
                                setTimeout(function () {
                                    $("#message").hide();
                                    window.location.href = '';
                                }, 2000);
                            }
                            else if (result == "IncorrectPWD") {

                                $("#messageBtnClose").show();
                                $("#message").addClass("error");
                                $("#message").show();
                                $("#message p").text('Incorrect Password!');
                                setTimeout(function () { $("#message").hide(); }, 2000);
                            }
                            else {
                                $("#messageBtnClose").show();
                                $("#message").addClass("error");
                                $("#message").show();
                                $("#message p").text('Error in Change Exposure Limit, please try again.');
                                setTimeout(function () { $("#message").hide(); }, 2000);
                            }
                        }, 1000);
                    }
                });
            }
        }
    </script>

    <script>

        MatchedClientBetRC();
        function MatchedClientBetRC() {
            $.ajax({
                type: "GET",
                url: "/Agent/DlClientList",
                dataType: "html",
                success: function (data) {
                    var a2 = JSON.parse(data);
                    for (i = 0; i < a2.length; i++) {
                        var myvar = ' <a href="/Agent/accountSummary/' + a2[i].id + '">' + a2[i].username + '</a>';
                        $('#userlist1').append(myvar);
                    }
                }
            });
        }
    </script>


